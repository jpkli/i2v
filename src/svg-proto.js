if (typeof(define) !== 'function') var define = require('amdefine')(module);

define(function(require) {

    function setAttr(elem, attr) {
        for( var key in attr ){
            var value = attr[key],
                c = key.match(/[A-Z]/);
            if(c !== null) key = key.replace(c[0], "-"+c[0].toLowerCase())
            elem.setAttribute(key, value);
        }
    }

    function setStyle(elem, style) {
        for( var key in style ){
            var value = style[key],
                c = key.match(/[A-Z]/);
            if(c !== null) key = key.replace(c[0], "-"+c[0].toLowerCase())
            elem.style[key] = value;
        }
    }

    function Svg(arg){
        'use strict';
        var self = (this instanceof Svg) ? this: {},
            option = arg || {},
            type = option.type || 'svg',
            svgNS = 'http://www.w3.org/2000/svg',
            svg = document.createElementNS(svgNS, type),
            width = option.width || 400,
            height = option.height || 300,
            parent = option.parent || option.container || this.parent,
            attr = option.attr || {},
            style = option.style || {},
            padding = option.padding || {left: 0, right: 0, top: 0, bottom: 0};

        if(type === 'svg') {
            var defaultAttr = {
                width   : width + padding.left + padding.right,
                height  : height + padding.top + padding.bottom,
                viewBox : [0, 0, width + padding.left + padding.right , height + padding.top + padding.bottom].join(' '),
                preserveAspectRatio: 'none'
            };
            setAttr(svg, defaultAttr);

            self.innerWidth = function() {
                return width;
            }

            self.innerHeight = function() {
                return height;
            }

            self.padding = function() {
                return padding;
            }
        }

        if(style) setStyle(svg, style);
        if(attr) setAttr(svg, attr);

        if(parent) {
            parent = (typeof parent == "string") ? document.getElementById(parent) : parent;
            parent.appendChild(svg);
        }

        self.svg = svg;
        self.parent = parent;

        if(self instanceof Svg)
            publicMethods(Svg.prototype);
        else
            publicMethods(self);

        return self;
    };

    function publicMethods(context) {
        context.append = function(type, attr, style) {
            var options = {};
            options.parent = this.svg;
            options.type = type;
            options.attr = attr;
            options.style = style;
            return new Svg(options);
        };

        context.remove = function() {
            this.parent.removeChild(this.svg);
        };

        context.attr = function(a, v) {
            if(typeof(a) == "object")
                setAttr(this.svg, a);
            else
                this.svg.setAttribute(a, v);

            return this;
        }

        context.Attr =  function(a, v) {
            setAttr(this.svg, a);
            return this;
        }

        context.Style =  function(a, v) {
            setStyle(this.svg, a);
            return this;
        }

        context.style = function(a, v) {
            if(typeof(a) == "object")
                setStyle(this.svg, a);
            else
                this.svg.style[a] = v;

            return this;
        }

        context.css = context.style;

        context.text = function(str){
            this.svg.appendChild(document.createTextNode(str));
            return this;
        };

        context.translate = function(x, y) {
            var p = this.svg.getAttribute("transform") || "";
            this.svg.setAttribute("transform", p + "translate(" + [x,y].join(",") + ") ");
            return this;
        };

        context.on = function(event, callback) {
            this.svg.addEventListner(event, callback);
            return this;
        }

        return context;
    }

    return Svg;
});
